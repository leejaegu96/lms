<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sumcofw.infra.modules.index.IndexMapper">

	<resultMap id="resultMapObj" type="com.sumcofw.infra.modules.index.Index"></resultMap>
	
	<!-- 강의 상세보기 페이지에서 강의 정보 불러오기  -->
	<select id = "lecturedetail" resultMap="resultMapObj">
		select
			a.iltSeq
            ,a.iltIftcSeq
			,a.iltTitle
			,a.iltBody
			,a.iltPrice
            ,b.iftcName
            ,b.iftcSeq   
		from
			idLecture a
		 left join infrTeacher b on a.iltIftcSeq = b.iftcSeq
		where
			1=1
			AND a.iltSeq = #{iltSeq}
            ;
	</select>
	
	<!-- 강의 챕터  -->
	<select id="chapterlist" resultMap="resultMapObj">
		select
			a.ichSeq
			,a.ichIltSeq
		    , c.iltTitle
		    , a.ichTitle
		    , b.ictSort
		    , b.ictSeq
		    , b. ictTitle
		
		from idChapterHeader a
		left join idChapter b on a.ichSeq = b.ictIchSeq
		left join idLecture c on a.ichIltSeq = c.iltSeq
		where
			1=1
		    AND c.iltSeq = #{iltSeq}
		order by b.ictSort asc
		    ;
	</select>

	<!-- 사용자 회원가입 -->
	<insert id="signUpProc">
		INSERT INTO `infrMember` (
			ifmmId
			,ifmmName
			,ifmmPassword
			,ifmmEmail
			,ifmmDomain
			,ifmmMobile
			,ifmmCarrier
			,ifmmRegDateTime
			,ifmmModDateTime
			,ifmmType	
		) VALUES (
			#{ifmmId}
			,#{ifmmName}
			,#{ifmmPassword}
			,#{ifmmEmail}
			,(select ifnull(ifcdSeq, 31) from infraCode where ifcdNameEng = #{ifmmDomain})
			,#{ifmmMobile}
			,#{ifmmCarrier}
			,now()
			,now()
			,#{ifmmType}
		)
	</insert>
	
	<!-- 사용자 로그인 -->
	<select id="loginProc" resultMap="resultMapObj">
		SELECT
			a.ifmmSeq
			,a.ifmmId
			,a.ifmmPassword
			,a.ifmmName
		FROM infrMember a
		WHERE 1=1
			AND a.ifmmId = #{ifmmId}
			AND a.ifmmPassword = #{ifmmPassword}
	</select>
	
</mapper>